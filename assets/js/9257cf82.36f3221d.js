"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[30682],{3905:(e,n,r)=>{r.d(n,{Zo:()=>u,kt:()=>d});var t=r(67294);function s(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function a(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,t)}return r}function o(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?a(Object(r),!0).forEach((function(n){s(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}function l(e,n){if(null==e)return{};var r,t,s=function(e,n){if(null==e)return{};var r,t,s={},a=Object.keys(e);for(t=0;t<a.length;t++)r=a[t],n.indexOf(r)>=0||(s[r]=e[r]);return s}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(t=0;t<a.length;t++)r=a[t],n.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(s[r]=e[r])}return s}var c=t.createContext({}),i=function(e){var n=t.useContext(c),r=n;return e&&(r="function"==typeof e?e(n):o(o({},n),e)),r},u=function(e){var n=i(e.components);return t.createElement(c.Provider,{value:n},e.children)},p={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},f=t.forwardRef((function(e,n){var r=e.components,s=e.mdxType,a=e.originalType,c=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),f=i(r),d=s,m=f["".concat(c,".").concat(d)]||f[d]||p[d]||a;return r?t.createElement(m,o(o({ref:n},u),{},{components:r})):t.createElement(m,o({ref:n},u))}));function d(e,n){var r=arguments,s=n&&n.mdxType;if("string"==typeof e||s){var a=r.length,o=new Array(a);o[0]=f;var l={};for(var c in n)hasOwnProperty.call(n,c)&&(l[c]=n[c]);l.originalType=e,l.mdxType="string"==typeof e?e:s,o[1]=l;for(var i=2;i<a;i++)o[i]=r[i];return t.createElement.apply(null,o)}return t.createElement.apply(null,r)}f.displayName="MDXCreateElement"},76305:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>p,frontMatter:()=>a,metadata:()=>l,toc:()=>i});var t=r(87462),s=(r(67294),r(3905));const a={title:"\u624b\u5199 Promise !29208",ID:"29208",date:"2022-01-19 10:28:15",authors:["lzw"],categories:["async","js-asyn"],tags:["async","js-asyn"],slug:"/29208",type:"issues"},o="\u624b\u5199 Promise",l={unversionedId:"async/29208",id:"async/29208",title:"\u624b\u5199 Promise !29208",description:"\u5b9e\u73b0 promise \u5e38\u7528\u65b9\u6cd5",source:"@site/issues/async/29208.md",sourceDirName:"async",slug:"/29208",permalink:"/docusaurus/issues/29208",draft:!1,tags:[{label:"async",permalink:"/docusaurus/issues/tags/async"},{label:"js-asyn",permalink:"/docusaurus/issues/tags/js-asyn"}],version:"current",frontMatter:{title:"\u624b\u5199 Promise !29208",ID:"29208",date:"2022-01-19 10:28:15",authors:["lzw"],categories:["async","js-asyn"],tags:["async","js-asyn"],slug:"/29208",type:"issues"},sidebar:"tutorialSidebar",previous:{title:"async/await \u8bed\u6cd5\u95ee\u9898 !26026",permalink:"/docusaurus/issues/26026"},next:{title:"\u7f51\u7edc",permalink:"/docusaurus/issues/network/"}},c={},i=[],u={toc:i};function p(e){let{components:n,...r}=e;return(0,s.kt)("wrapper",(0,t.Z)({},u,r,{components:n,mdxType:"MDXLayout"}),(0,s.kt)("h1",{id:"\u624b\u5199-promise"},"\u624b\u5199 Promise"),(0,s.kt)("p",null,"\u5b9e\u73b0 promise \u5e38\u7528\u65b9\u6cd5"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"\u521d\u59cb\u5316 & \u5f02\u6b65\u8c03\u7528"),(0,s.kt)("li",{parentName:"ul"},"then catch \u94fe\u5f0f\u8c03\u7528"),(0,s.kt)("li",{parentName:"ul"},"\u5b9e\u73b0 API: .resolve .reject .all .race")),(0,s.kt)("p",null,"\u4ee3\u7801\u5b9e\u73b0 MyPromise"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-js"},"class MyPromise {\n  state = 'pending' //\u72b6\u6001 pending,fulfilled,rejected\n  value = undefined // \u6210\u529f\u540e\u7684\u503c\n  reason = undefined // \u5931\u8d25\u540e\u7684\u539f\u56e0\n\n  resolveCallbacks = [] // pending \u4e0b\uff0c\u5b58\u50a8\u6210\u529f\u7684\u56de\u8c03\n  rejectCallbacks = [] // pending \u4e0b\uff0c\u5b58\u50a8\u5931\u8d25\u7684\u56de\u8c03\n\n  constructor(fn) {\n    const resolveHandler = (value) => {\n      if (this.state === 'pending') {\n        this.state = 'fulfilled'\n        this.value = value\n        // \u72b6\u6001\u53d8\u5316\u540e\uff0c\u51fd\u6570\u6267\u884c\n        this.resolveCallbacks.forEach(fn => fn(this.value))\n      }\n    }\n\n    const rejectHandler = (reason) => {\n      if (this.state === 'pending') {\n        this.state = 'rejected'\n        this.reason = reason\n        // \u72b6\u6001\u53d8\u5316\u540e\uff0c\u51fd\u6570\u6267\u884c\n        this.rejectCallbacks.forEach(fn => fn(this.reason))\n      }\n    }\n\n    try {\n      fn(resolveHandler, rejectHandler)\n    } catch (err) {\n      resolveHandler(err)\n    }\n  }\n\n  then(fn1, fn2) {\n    // \u5f53 pending \u4e0b\uff0cfn1,fn2 \u5b58\u50a8\u5230 callbacks \u4e2d\n    fn1 = typeof fn1 === 'function' ? fn1 : (v) => v\n    fn2 = typeof fn2 === 'function' ? fn2 : (e) => e\n\n    // \u51fd\u6570\u8fd8\u6ca1\u6267\u884c\uff0c\u8fd4\u56de\u65b0\u7684 promise\n    if (this.state === 'pending') {\n      const p1 = new MyPromise((resolve, reject) => {\n        this.resolveCallbacks.push(() => {\n          try {\n            const newValue = fn1(this.value)\n            resolve(newValue)\n          } catch (err) {\n            reject(err)\n          }\n        })\n        this.rejectCallbacks.push(() => {\n          try {\n            const newReason = fn1(this.reason)\n            reject(newReason)\n          } catch (err) {\n            reject(err)\n          }\n        })\n      })\n      return p1\n    }\n\n    // fn1 \u51fd\u6570\u6267\u884c\uff0c\u8fd4\u56de\u65b0\u7684 promise\n    if (this.state === 'fulfilled') {\n      const p1 = new MyPromise((resolve, reject) => {\n        try {\n          const newValue = fn1(this.value)\n          resolve(newValue)\n        } catch (err) {\n          reject(err)\n        }\n      })\n      return p1\n    }\n\n    // fn2 \u51fd\u6570\u6267\u884c\uff0c\u8fd4\u56de\u65b0\u7684 promise\n    if (this.state === 'rejected') {\n      const p1 = new MyPromise((resolve, reject) => {\n        try {\n          const newReason = fn2(this.reason)\n          reject(newReason)\n        } catch (err) {\n          reject(err)\n        }\n      })\n      return p1\n    }\n  }\n\n  // catch \u5c31\u662f then \u7684\u4e00\u4e2a\u8bed\u6cd5\u7cd6\uff0c\u7b80\u5355\u6a21\u5f0f\n  catch(fn) {\n    return this.then(null, fn)\n  }\n}\n\n// \u5168\u5c40\u9759\u6001\u65b9\u6cd5\nMyPromise.resolve = function (value) {\n  return new MyPromise((resolve, reject) => resolve(value))\n}\n\nMyPromise.reject = function (reason) {\n  return new MyPromise((resolve, reject) => reject(reason))\n}\n\nMyPromise.all = function (promiseList = []) {\n  const p1 = new MyPromise((resolve, reject) => {\n    const result = [] // \u5b58\u50a8 promiseList \u6240\u6709\u7684\u7ed3\u679c\n    const length = promiseList.length\n    let resolvedCount = 0\n\n    promiseList.forEach(p => {\n      p.then(data => {\n        result.push(data)\n\n        // resolvedCount \u5fc5\u987b\u5728 then \u91cc\u9762\u505a ++\n        // \u4e0d\u80fd\u4f7f\u7528 foreach \u7684 index\uff0c\u56e0\u4e3a index \u662f\u540c\u6b65\u7684\n        resolvedCount++\n        if (resolvedCount == length) {\n          // \u5df2\u7ecf\u5230\u6700\u540e\u4e00\u4e2a\n          resolve(result)\n        }\n      }).catch(err => {\n        reject(err)\n      })\n    })\n  })\n  return p1\n}\n\nMyPromise.race = function (promiseList = []) {\n  let resolved = false // \u6807\u8bb0\n  const p1 = new MyPromise((resolve, reject) => {\n    promiseList.forEach(p => {\n      p.then(data => {\n        if (!resolved) {\n          resolve(data)\n          resolved = true\n        }\n      }).catch(err => {\n        reject(err)\n      })\n    })\n  })\n  return p1\n}\n")),(0,s.kt)("p",null,"\u6d4b\u8bd5\u4ee3\u7801"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-js"},"// \u666e\u901a\u8c03\u7528\nconst p1 = new MyPromise((resolve, reject) => {\n  // resolve(100)\n  // reject('\u9519\u8bef...')\n  setTimeout(() => {\n    resolve(100)\n  }, 1000)\n})\n\n// \u94fe\u5f0f\u8c03\u7528\nconst p11 = p1.then(data1 => {\n  console.log('data1', data1) // data1 100\n  return data1 + 1\n})\nconst p12 = p11.then(data2 => {\n  console.log('data2', data2) // data2 101\n  return data2 + 1\n})\nconst p13 = p12.catch(err => console.error(err))\n\n// api \u8c03\u7528\nconst p2 = MyPromise.resolve(200)\nconst p3 = MyPromise.resolve(300)\nconst p4 = MyPromise.reject('\u9519\u8bef...')\n// \u4f20\u5165 promise \u6570\u7ec4\uff0c\u7b49\u5f85\u6240\u6709\u7684\u90fd fulfilled \u540e\uff0c\u8fd4\u56de\u65b0\u7684 promise \u5305\u542b\u524d\u9762\u6240\u6709\u7684\u7ed3\u679c\nconst p5 = MyPromise.all([p1, p2, p3])\np5.then(result => console.log('all result', result)) // all result (3)[200, 300, 100]\n// \u4f20\u5165 promise \u6570\u7ec4\uff0c\u53ea\u8981\u6709\u4e00\u4e2a fulfilled \u5373\u53ef\u8fd4\u56de\nconst p6 = MyPromise.race([p1, p2, p3])\np6.then(result => console.log('race result', result)) // race result 200\n")))}p.isMDXComponent=!0}}]);