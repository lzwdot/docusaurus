"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[60030],{3905:(n,e,t)=>{t.d(e,{Zo:()=>d,kt:()=>u});var s=t(67294);function i(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function o(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,s)}return t}function r(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?o(Object(t),!0).forEach((function(e){i(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}function a(n,e){if(null==n)return{};var t,s,i=function(n,e){if(null==n)return{};var t,s,i={},o=Object.keys(n);for(s=0;s<o.length;s++)t=o[s],e.indexOf(t)>=0||(i[t]=n[t]);return i}(n,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);for(s=0;s<o.length;s++)t=o[s],e.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(n,t)&&(i[t]=n[t])}return i}var l=s.createContext({}),c=function(n){var e=s.useContext(l),t=e;return n&&(t="function"==typeof n?n(e):r(r({},e),n)),t},d=function(n){var e=c(n.components);return s.createElement(l.Provider,{value:e},n.children)},h={inlineCode:"code",wrapper:function(n){var e=n.children;return s.createElement(s.Fragment,{},e)}},g=s.forwardRef((function(n,e){var t=n.components,i=n.mdxType,o=n.originalType,l=n.parentName,d=a(n,["components","mdxType","originalType","parentName"]),g=c(t),u=i,p=g["".concat(l,".").concat(u)]||g[u]||h[u]||o;return t?s.createElement(p,r(r({ref:e},d),{},{components:t})):s.createElement(p,r({ref:e},d))}));function u(n,e){var t=arguments,i=e&&e.mdxType;if("string"==typeof n||i){var o=t.length,r=new Array(o);r[0]=g;var a={};for(var l in e)hasOwnProperty.call(e,l)&&(a[l]=e[l]);a.originalType=n,a.mdxType="string"==typeof n?n:i,r[1]=a;for(var c=2;c<o;c++)r[c]=t[c];return s.createElement.apply(null,r)}return s.createElement.apply(null,t)}g.displayName="MDXCreateElement"},40179:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>l,contentTitle:()=>r,default:()=>u,frontMatter:()=>o,metadata:()=>a,toc:()=>c});var s=t(87462),i=(t(67294),t(3905));const o={title:"\u4f7f\u7528 canvas \u5b9e\u73b0\u6ed1\u52a8\u9a8c\u8bc1\u7801",ID:"27987",date:"2021-10-10 20:52:22",categories:["js-ts","js-study"],tags:["js-ts","js-study"],authors:["lzw"],slug:"/27987",type:"blog"},r=void 0,a={permalink:"/docusaurus/blog/27987",editUrl:"https://github.com/lzwdot/docusaurus/blog/2021/10-10-27987.md",source:"@site/blog/2021/10-10-27987.md",title:"\u4f7f\u7528 canvas \u5b9e\u73b0\u6ed1\u52a8\u9a8c\u8bc1\u7801",description:"\u4f7f\u7528 canvas \u5b9e\u73b0\u7684\u6ed1\u52a8\u9a8c\u8bc1\u7801",date:"2021-10-10T20:52:22.000Z",formattedDate:"2021\u5e7410\u670810\u65e5",tags:[{label:"js-ts",permalink:"/docusaurus/blog/tags/js-ts"},{label:"js-study",permalink:"/docusaurus/blog/tags/js-study"}],readingTime:4.98,hasTruncateMarker:!0,authors:[{name:"lzw.",title:"\u4e00\u4e2a web \u5f00\u53d1\u8005",url:"https://github.com/lzwdot",imageURL:"https://avatars.githubusercontent.com/u/24477920?v=4",key:"lzw"}],frontMatter:{title:"\u4f7f\u7528 canvas \u5b9e\u73b0\u6ed1\u52a8\u9a8c\u8bc1\u7801",ID:"27987",date:"2021-10-10 20:52:22",categories:["js-ts","js-study"],tags:["js-ts","js-study"],authors:["lzw"],slug:"/27987",type:"blog"},prevItem:{title:"\u9879\u76ee\u4eae\u70b9\u5b9e\u6218",permalink:"/docusaurus/blog/28802"},nextItem:{title:"\u968f\u673a\u5bc6\u7801\u751f\u6210\u5668",permalink:"/docusaurus/blog/27986"}},l={authorsImageUrls:[void 0]},c=[{value:"\u4f7f\u7528 canvas \u5b9e\u73b0\u7684\u6ed1\u52a8\u9a8c\u8bc1\u7801",id:"\u4f7f\u7528-canvas-\u5b9e\u73b0\u7684\u6ed1\u52a8\u9a8c\u8bc1\u7801",level:3}],d=(h="HtmlDemo",function(n){return console.warn("Component "+h+" was not imported, exported, or provided by MDXProvider as global scope"),(0,i.kt)("div",n)});var h;const g={toc:c};function u(n){let{components:e,...t}=n;return(0,i.kt)("wrapper",(0,s.Z)({},g,t,{components:e,mdxType:"MDXLayout"}),(0,i.kt)("h3",{id:"\u4f7f\u7528-canvas-\u5b9e\u73b0\u7684\u6ed1\u52a8\u9a8c\u8bc1\u7801"},"\u4f7f\u7528 canvas \u5b9e\u73b0\u7684\u6ed1\u52a8\u9a8c\u8bc1\u7801"),(0,i.kt)(d,{mdxType:"HtmlDemo"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-html"},"<div id=\"slideJigsaw\" class=\"slide-jigsaw\">\n    <canvas class=\"panel\"></canvas>\n    <canvas class=\"jigsaw\"></canvas>\n    <div class=\"refresh\"><i class=\"icon\"></i></div>\n    <div class=\"loading\">\n        <div class=\"wrap\">\n            <i class=\"icon\"></i>\n            <p>\u52a0\u8f7d\u4e2d...</p>\n        </div>\n    </div>\n    <div class=\"control\">\n        <div class=\"indicator\"></div>\n        <div class=\"slider\"><i class=\"icon\"></i></div>\n        <div class=\"tips\">\u5411\u53f3\u62d6\u52a8\u6ed1\u5757\u586b\u5145\u62fc\u56fe</div>\n    </div>\n</div>\n<script>\nwindow.onload = function(){\n  const slideJigsaw = {\n    init(options, onSuccess, onFail) {\n      this.slideJigsaw = document.querySelector('#slideJigsaw')\n\n      // dom\n      this.panel = this.slideJigsaw.querySelector('.panel')\n      this.jigsaw = this.slideJigsaw.querySelector('.jigsaw')\n      this.loading = this.slideJigsaw.querySelector('.loading')\n      this.refresh = this.slideJigsaw.querySelector('.refresh')\n      this.indicator = this.slideJigsaw.querySelector('.indicator')\n      this.slider = this.slideJigsaw.querySelector('.slider')\n      this.tips = this.slideJigsaw.querySelector('.tips')\n      this.img = document.createElement('img')\n\n      // size\n      this.w = this.panel.offsetWidth\n      this.h = this.panel.offsetHeight\n      this.l = 40\n      this.r = 10\n      this.x = 0\n      this.y = 0\n\n      // options\n      Object.assign(this, options)\n      this.onSuccess = onSuccess\n      this.onFail = onFail\n\n      // canvas\n      this.panel_ctx = this.panel.getContext('2d')\n      this.jigsaw_ctx = this.jigsaw.getContext('2d')\n\n      // reset\n      this.resetDraw()\n    },\n\n    resetDraw() {\n      const _w = this.l + this.r * 2\n\n      this.jigsaw.width = this.w\n      this.indicator.style.width = this.numToPx(0)\n      this.jigsaw.style.left = this.numToPx(0)\n      this.slider.style.left = this.numToPx(0)\n\n      this.x = Math.floor(Math.random() * (this.w - _w * 2) + _w)\n      this.y = Math.floor(Math.random() * (this.h - _w) + this.r * 2)\n\n      this.panel_ctx.clearRect(0, 0, this.w, this.h)\n      this.jigsaw_ctx.clearRect(0, 0, this.w, this.h)\n\n      // img src\n      this.setImgSrc()\n\n      // draw\n      this.drawPath(this.panel_ctx, 'fill')\n      this.drawPath(this.jigsaw_ctx, 'clip')\n    },\n\n    setImgSrc() {\n      this.showLoading(true)\n      this.showTips(true)\n      this.setState('')\n\n      this.img.crossOrigin = \"anonymous\"\n      this.img.src = `https://fakeimg.pl/${this.w}x${this.h}/${this.randomInt(1000)}/`\n      this.img.onerror = () => this.resetDraw()\n      this.img.onload = () => {\n        this.panel_ctx.drawImage(this.img, 0, 0, this.w, this.h)\n        this.jigsaw_ctx.drawImage(this.img, 0, 0, this.w, this.h)\n\n        const _w = this.l + this.r * 2\n        const _y = this.y - this.r * 2\n        const imageData = this.jigsaw_ctx.getImageData(this.x, _y, _w, _w)\n\n        this.jigsaw.width = _w // do not use style width\n        this.jigsaw_ctx.putImageData(imageData, 0, _y)\n\n        // hide loading\n        this.showLoading(false)\n\n        // events\n        this.bindEvents()\n      }\n    },\n\n    drawPath(ctx, operation) {\n      const {x, y, l, r} = this\n      const PI = Math.PI\n\n      ctx.beginPath()\n      ctx.moveTo(x, y)\n\n      // draw top circle (clockwise from bottom 0.5 to 2.5)\n      ctx.arc(x + l / 2, y - r + 2.5, r, (0.5 + 0.25) * PI, (2.5 - 0.25) * PI)\n      ctx.lineTo(x + l, y)\n\n      // draw left circle (clockwise from left 1 to 3)\n      ctx.arc(x + l + r - 2.5, y + l / 2, r, (1 + 0.25) * PI, (3 - 0.25) * PI)\n\n      // draw rect\n      ctx.lineTo(x + l, y + l)\n      ctx.lineTo(x, y + l)\n\n      // draw left concave semicircle(anti-clockwise from left 1 to 3)\n      ctx.arc(x + r - 2.5, y + l / 2, r, (3 - 0.25) * PI, (1 + 0.25) * PI, true)\n      ctx.lineTo(x, y)\n      ctx.lineWidth = 2\n\n      ctx.fillStyle = 'rgba(255, 255, 255, 0.5)' // fill style\n      ctx.strokeStyle = 'rgba(255, 255, 255, 0.5)' // border style\n      ctx.stroke()\n\n      ctx.globalCompositeOperation = 'destination-over'\n      ctx[operation === 'fill' ? 'fill' : 'clip']() //fill or clip\n    },\n\n    bindEvents() {\n      let oX = 0\n      let oY = 0\n      let canMove = false\n\n      const dragStart = (e) => {\n        oX = e.x || e.touches[0].clientX\n        oY = e.y || e.touches[0].clientY\n        canMove = true\n\n        this.showTips(false)\n      }\n\n      const dragMove = (e) => {\n        if (!canMove) return\n        e.preventDefault()\n\n        const mX = (e.x || e.touches[0].clientX) - oX\n        const jigsaw_x = mX < 0 ? Math.max(0, mX) : Math.min(this.w - this.l - this.r * 2, mX)\n        const slider_x = mX < 0 ? Math.max(0, mX) : Math.min(this.w - this.slider.offsetWidth, mX)\n\n        this.jigsaw.style.left = this.numToPx(jigsaw_x)\n        this.slider.style.left = this.numToPx(slider_x)\n        this.indicator.style.width = this.numToPx(slider_x)\n      }\n\n      const dragEnd = (e) => {\n        if (!canMove) return\n        canMove = false\n\n        const left = parseInt(this.jigsaw.style.left)\n        if (Math.abs(left - this.x) < this.r / 4) {\n          this.setState('onSuccessess')\n          typeof this.onSuccess === 'function' && this.onSuccess()\n        } else {\n          this.setState('onFail')\n          typeof this.onFail === 'function' && this.onFail()\n\n          setTimeout(() => {\n            this.resetDraw()\n          }, 1000)\n        }\n\n        // touch\n        this.slider.removeEventListener('touchstart', dragStart)\n        document.removeEventListener('touchmove', dragMove)\n        document.removeEventListener('touchend', dragEnd)\n        // mouse event\n        this.slider.removeEventListener('mousedown', dragStart)\n        document.removeEventListener('mousemove', dragMove)\n        document.removeEventListener('mouseup', dragEnd)\n      }\n\n      // touch\n      this.slider.addEventListener('touchstart', dragStart)\n      document.addEventListener('touchmove', dragMove)\n      document.addEventListener('touchend', dragEnd)\n      // mouse event\n      this.slider.addEventListener('mousedown', dragStart)\n      document.addEventListener('mousemove', dragMove)\n      document.addEventListener('mouseup', dragEnd)\n\n      // refresh\n      this.refresh.addEventListener('click', () => this.resetDraw())\n    },\n\n    numToPx(num) {\n      return num + 'px'\n    },\n\n    randomInt(num) {\n      return Math.floor(Math.random() * (num || 1000) + 1)\n    },\n\n    showLoading(show) {\n      this.loading.style.display = show ? 'block' : 'none'\n      this.slideJigsaw.style.pointerEvents = show ? 'none' : ''\n    },\n\n    showTips(show) {\n      this.tips.style.display = show ? 'block' : 'none'\n    },\n\n    setState(state) {\n      this.slider.className = 'slider ' + state\n    }\n } \n slideJigsaw.init({}, \n      () => { console.log('sucss')}, \n      () => { console.log('fail')}\n  )\n}\n<\/script>\n<style>\n    .slide-jigsaw,\n    .slide-jigsaw .panel,\n    .slide-jigsaw .control {\n        position: relative;\n        font-size: 14px;\n    }\n\n    .slide-jigsaw,\n    .slide-jigsaw .panel,\n    .slide-jigsaw .loading {\n        height: 150px;\n        width: 300px;\n    }\n\n\n    .slide-jigsaw .loading,\n    .slide-jigsaw .refresh,\n    .slide-jigsaw .indicator,\n    .slide-jigsaw .slider,\n    .slide-jigsaw .jigsaw {\n        position: absolute;\n        top: 0;\n        left: 0;\n    }\n\n    .slide-jigsaw .icon {\n        width: 32px;\n        height: 32px;\n        display: inline-block;\n        cursor: pointer;\n        background-image: url(\"//cstaticdun.126.net/2.16.0/images/icon_light.fa89a9e.png\");\n        background-repeat: no-repeat;\n        background-size: 32px 711px;\n    }\n\n    .slide-jigsaw .loading {\n        font-size: 12px;\n        z-index: 100;\n        background-color: #f7f9fa;\n    }\n\n    .slide-jigsaw .loading .wrap {\n        display: flex;\n        width: 100%;\n        height: 100%;\n        flex-direction: column;\n        justify-content: center;\n        align-items: center;\n    }\n\n    .slide-jigsaw .loading .icon {\n        background-position: 0 -499px;\n        animation: loading-rotate 1s linear infinite;\n    }\n\n    .slide-jigsaw .refresh {\n        left: initial;\n        right: 0;\n    }\n\n    .slide-jigsaw .refresh .icon {\n        background-position: 0 -333px;\n    }\n\n    .slide-jigsaw .refresh:hover .icon {\n        background-position: 0 -366px;\n    }\n\n    .slide-jigsaw .control {        \n        text-align: center;\n        width: 298px;\n        height: 40px;\n        line-height: 40px;\n        margin-top: 10px;\n        border: 1px solid #e4e7eb;\n        background-color: #f7f9fa;\n        color: #45494c;\n    }\n\n    .slide-jigsaw .indicator {\n        height: 38px;\n        border: 1px solid #1991fa;\n        background-color: #d1e9fe;\n        -webkit-overflow-scrolling: touch;\n    }\n\n    .slide-jigsaw .slider {\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        width: 40px;\n        height: 40px;\n        background-color: #fff;\n        box-shadow: 0 0 3px rgba(0, 0, 0, .3);\n        cursor: pointer;\n        transition: background .2s linear;\n        -webkit-overflow-scrolling: touch;\n    }\n\n    .slide-jigsaw .slider .icon {\n        background-position: 0 -12px;\n        width: 15px;\n        height: 12px;\n    }\n\n    .slide-jigsaw .slider:hover {\n        background-color: #1991fa;\n        transition: background .2s linear\n    }\n\n    .slide-jigsaw .slider:hover .icon {\n        background-position: 0 0;\n    }\n\n    .slide-jigsaw .slider.onSuccessess {\n        height: 38px;\n        border: 1px solid #52ccba;\n        background-color: #d2f4ef;\n    }\n\n    .slide-jigsaw .slider.onSuccessess .icon,\n    .slide-jigsaw .slider.onSuccessess:hover .icon {\n        width: 18px;\n        height: 15px;\n        background-position: 0 -65px;\n    }\n\n    .slide-jigsaw .slider.onFail {\n        height: 38px;\n        border: 1px solid #f57a7a;\n        background-color: #fce1e1;\n    }\n\n    .slide-jigsaw .slider.onFail .icon,\n    .slide-jigsaw .slider.onFail:hover .icon {\n        width: 12px;\n        height: 15px;\n        background-position: 0 -95px;\n    }\n\n    @keyframes loading-rotate {\n        from {\n            transform: rotate(0)\n        }\n        to {\n            transform: rotate(360deg)\n        }\n    }\n</style>\n"))))}u.isMDXComponent=!0}}]);