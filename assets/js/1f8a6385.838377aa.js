"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[91209],{3905:(e,t,n)=>{n.d(t,{Zo:()=>i,kt:()=>d});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var p=a.createContext({}),c=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},i=function(e){var t=c(e.components);return a.createElement(p.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,p=e.parentName,i=s(e,["components","mdxType","originalType","parentName"]),m=c(n),d=r,g=m["".concat(p,".").concat(d)]||m[d]||u[d]||o;return n?a.createElement(g,l(l({ref:t},i),{},{components:n})):a.createElement(g,l({ref:t},i))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,l=new Array(o);l[0]=m;var s={};for(var p in t)hasOwnProperty.call(t,p)&&(s[p]=t[p]);s.originalType=e,s.mdxType="string"==typeof e?e:r,l[1]=s;for(var c=2;c<o;c++)l[c]=n[c];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},36212:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>l,default:()=>u,frontMatter:()=>o,metadata:()=>s,toc:()=>c});var a=n(87462),r=(n(67294),n(3905));const o={title:"h5\u5229\u7528cropper.js\u5b9e\u73b0\u56fe\u7247\u88c1\u526a",ID:"22645",date:"2019-02-13 15:10:34",categories:["posts","js-css"],tags:["posts","js-css"],authors:["lzw"],slug:"/22645",type:"blog"},l=void 0,s={permalink:"/docusaurus/blog/22645",editUrl:"https://github.com/lzwdot/docusaurus/blog/2019/02-13-22645.md",source:"@site/blog/2019/02-13-22645.md",title:"h5\u5229\u7528cropper.js\u5b9e\u73b0\u56fe\u7247\u88c1\u526a",description:"\u6700\u8fd1\u4e3a\u4e86\u5b9e\u73b0h5\u56fe\u7247\u88c1\u526a\u529f\u80fd\uff0c\u5728\u7f51\u4e0a\u67e5\u9605\u4e86\u5f88\u591a\u8d44\u6599\uff0c\u6700\u540e\u627e\u5230cropper.js\u975e\u5e38\u597d\u7528\uff0c\u4ee5\u6b64\u8bb0\u5f55\u4e0b\u5b9e\u73b0\u8fc7\u7a0b\uff1a",date:"2019-02-13T15:10:34.000Z",formattedDate:"2019\u5e742\u670813\u65e5",tags:[{label:"posts",permalink:"/docusaurus/blog/tags/posts"},{label:"js-css",permalink:"/docusaurus/blog/tags/js-css"}],readingTime:5.285,hasTruncateMarker:!0,authors:[{name:"lzw.",title:"\u4e00\u4e2a web \u5f00\u53d1\u8005",url:"https://github.com/lzwdot",imageURL:"https://avatars.githubusercontent.com/u/24477920?v=4",key:"lzw"}],frontMatter:{title:"h5\u5229\u7528cropper.js\u5b9e\u73b0\u56fe\u7247\u88c1\u526a",ID:"22645",date:"2019-02-13 15:10:34",categories:["posts","js-css"],tags:["posts","js-css"],authors:["lzw"],slug:"/22645",type:"blog"},prevItem:{title:"\u5982\u4f55\u7981\u7528http\u7684delete put trace \u65b9\u6cd5",permalink:"/docusaurus/blog/22650"},nextItem:{title:"Windows\u4e0b\u7528Nginx\u914d\u7f6ehttps\u670d\u52a1\u5668",permalink:"/docusaurus/blog/22177"}},p={authorsImageUrls:[void 0]},c=[{value:"\u5173\u4e8ecropper.js",id:"\u5173\u4e8ecropperjs",level:3},{value:"\u524d\u7aef\u56fe\u7247\u88c1\u526a\u5904\u7406",id:"\u524d\u7aef\u56fe\u7247\u88c1\u526a\u5904\u7406",level:2},{value:"\u540e\u7aefphp\u63a5\u6536\u88c1\u526a\u56fe\u7247\u6570\u636e",id:"\u540e\u7aefphp\u63a5\u6536\u88c1\u526a\u56fe\u7247\u6570\u636e",level:2}],i={toc:c};function u(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},i,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"\u6700\u8fd1\u4e3a\u4e86\u5b9e\u73b0h5\u56fe\u7247\u88c1\u526a\u529f\u80fd\uff0c\u5728\u7f51\u4e0a\u67e5\u9605\u4e86\u5f88\u591a\u8d44\u6599\uff0c\u6700\u540e\u627e\u5230cropper.js\u975e\u5e38\u597d\u7528\uff0c\u4ee5\u6b64\u8bb0\u5f55\u4e0b\u5b9e\u73b0\u8fc7\u7a0b\uff1a"),(0,r.kt)("h3",{id:"\u5173\u4e8ecropperjs"},"\u5173\u4e8ecropper.js"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"cropper\u662f\u4e00\u6b3e\u4f7f\u7528\u7b80\u5355\u4e14\u529f\u80fd\u5f3a\u5927\u7684\u56fe\u7247\u526a\u88c1js\u63d2\u4ef6\u3002\u8be5\u56fe\u7247\u526a\u88c1\u63d2\u4ef6\u652f\u6301\u56fe\u7247\u653e\u5927\u7f29\u5c0f\uff0c\u652f\u6301\u9f20\u6807\u6eda\u8f6e\u64cd\u4f5c\uff0c\u652f\u6301\u56fe\u7247\u65cb\u8f6c\uff0c\u652f\u6301\u89e6\u6478\u5c4f\u8bbe\u5907\uff0c\u652f\u6301canvas\uff0c\u5e76\u4e14\u652f\u6301\u8de8\u6d4f\u89c8\u5668\u4f7f\u7528",(0,r.kt)("br",{parentName:"p"}),"\n","\u5b98\u65b9\u7f51\u7ad9\uff1a",(0,r.kt)("a",{parentName:"p",href:"http://fengyuanchen.github.io/cropper/"},"http://fengyuanchen.github.io/cropper/"))),(0,r.kt)("h2",{id:"\u524d\u7aef\u56fe\u7247\u88c1\u526a\u5904\u7406"},"\u524d\u7aef\u56fe\u7247\u88c1\u526a\u5904\u7406"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u5f15\u5165cropper\u6587\u4ef6\uff0c\u521d\u59cb\u5316\u6587\u6863\u7ed3\u6784")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'<!DOCTYPE html>\n<html>\n<head>\n<link rel="stylesheet" href="./cropper.min.css">\n</head>\n<body>\n    \x3c!--\u6587\u4ef6\u4e0a\u4f20--\x3e\n    <input type="file" class="js-uploadfile">\n    \x3c!--\u786e\u5b9a\u88c1\u526a--\x3e\n    <input type="button" class="js-ok" value="\u88c1\u526a">\n    \x3c!--cropper\u57fa\u672c\u7ed3\u6784--\x3e\n    <div class="container js-container">\n        <img class="js-image" src="">\n    </div>\n    \x3c!--\u88c1\u526a\u7ed3\u679c\u663e\u793a--\x3e\n    <br/>\n    <div class="js-result"></div>\n    <script src="./jquery-1.10.1.min.js"><\/script>\n    <script src="./cropper.min.js"><\/script>\n    <script>//\u5176\u4ed6js\u4ee3\u7801<\/script>\n</body>\n</html> \n')),(0,r.kt)("p",null,"\u4ee5\u4e0a\u4ee3\u7801\u5305\u542b\u6587\u4ef6\u4e0a\u4f20\uff0c\u88c1\u526a\u6309\u94ae\u548ccropper\u57fa\u672c\u7ed3\u6784\uff0c\u6253\u597d\u7ed3\u6784\u67b6\u5b50\uff0c\u4e0b\u9762\u5c31\u662f\u529f\u80fd\u7684\u5b9e\u73b0"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u6838\u5fc3js\u4ee3\u7801\uff0c\u5b9e\u73b0\u529f\u80fd\u6709\uff1a")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u6587\u4ef6\u4e0a\u4f20"),(0,r.kt)("li",{parentName:"ul"},"\u56fe\u7247\u88c1\u526a"),(0,r.kt)("li",{parentName:"ul"},"\u56fe\u7247\u63d0\u4ea4")),(0,r.kt)("p",null,"\u6839\u636einput","[","type=file","]","\u7684\u503c\u53d8\u5316\u83b7\u53d6\u56fe\u7247\u7684base64\u6587\u4ef6\u4fe1\u606f"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"var cropper;\n$(\".js-uploadfile\").on(\"change\", function () {\n    var fr = new FileReader();\n    var file = this.files[0];\n    if (!/image/w+/.test(file.type)) {\n        showTips(file.name + \"\u4e0d\u662f\u56fe\u7247\u6587\u4ef6\uff01\");\n        return false;\n    } else if (file.size > 2 * 1024 * 1024) {\n        showTips('\u56fe\u7247\u5927\u5c0f\u4e0d\u80fd\u8d85\u8fc72M');\n        return false;\n    }\n    fr.readAsDataURL(file);\n    fr.onload = function () {\n        //\u8fd9\u91cc\u521d\u59cb\u5316cropper\n        console.log(fr);\n        $('.js-image').attr('src',fr.result);\n        iniCropper()\n    };\n}); \n")),(0,r.kt)("p",null,"\u7136\u540e\u521d\u59cb\u5316cropper\uff0c\u53c2\u6570\u89e3\u91ca\u53c2\u8003\u5b98\u65b9\u6587\u6863"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"var croppable = false;\nfunction iniCropper() {\n    var $image = $('.js-image'),\n        image = $image[0];\n    cropper = new Cropper(image, {\n        dragMode: 'move',\n        aspectRatio: 1,\n        autoCropArea: 0.65,\n        restore: false,\n        viewMode: 1,\n        guides: false,\n        center: false,\n        highlight: false,\n        cropBoxMovable: false,\n        cropBoxResizable: false,\n        toggleDragModeOnDblclick: false,\n        ready: function () {\n            croppable = true;\n        }\n    });\n} \n")),(0,r.kt)("p",null,"\u5b9e\u73b0\u88c1\u526a\uff0c\u5e76\u4e0a\u4f20\u56fe\u7247\u3002\u8fd9\u91cc\u9700\u8981\u8c03\u7528\u4e24\u4e2a\u51fd\u6570getRectCanvas\uff0cconvertBase64UrlToBlob\uff1a",(0,r.kt)("br",{parentName:"p"}),"\n","getRectCanvas\uff1a\u7528\u4e8e\u7ed8\u5236\u77e9\u5f62Canvas\uff0c",(0,r.kt)("br",{parentName:"p"}),"\n","convertBase64UrlToBlob\uff1a\u5c06\u4ee5base64\u7684\u56fe\u7247url\u6570\u636e\u8f6c\u6362\u4e3aBlob"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"$('.js-ok').on('click', function () {\n    var croppedCanvas;\n    var rectCanvas;\n    var rectImage;\n    if (!croppable) {\n        return false;\n    }\n    // Crop\n    croppedCanvas = cropper.getCroppedCanvas();\n    //Rect\n    rectCanvas = getRectCanvas(croppedCanvas);\n    // Show\n    rectImage = document.createElement('img');\n    rectImage.src = rectCanvas.toDataURL();\n    $('.js-result').html('').append(rectImage);\n    //var form=document.forms[0];\n    var formData = new FormData();   //\u8fd9\u91cc\u8fde\u5e26form\u91cc\u7684\u5176\u4ed6\u53c2\u6570\u4e5f\u4e00\u8d77\u63d0\u4ea4\u4e86,\u5982\u679c\u4e0d\u9700\u8981\u63d0\u4ea4\u5176\u4ed6\u53c2\u6570\u53ef\u4ee5\u76f4\u63a5FormData\u65e0\u53c2\u6570\u7684\u6784\u9020\u51fd\u6570\n    //convertBase64UrlToBlob\u51fd\u6570\u662f\u5c06base64\u7f16\u7801\u8f6c\u6362\u4e3aBlob\n    formData.append(\"filename\", convertBase64UrlToBlob(rectCanvas.toDataURL()));  //append\u51fd\u6570\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u540e\u53f0\u83b7\u53d6\u6570\u636e\u7684\u53c2\u6570\u540d,\u548chtml\u6807\u7b7e\u7684input\u7684name\u5c5e\u6027\u529f\u80fd\u76f8\u540c\n    //ajax \u63d0\u4ea4form\n    return false;//\u4e0d\u63d0\u4ea4\n    $.ajax({\n        url: '',\n        type: \"POST\",\n        data: formData,\n        dataType: \"text\",\n        processData: false,         // \u544a\u8bc9jQuery\u4e0d\u8981\u53bb\u5904\u7406\u53d1\u9001\u7684\u6570\u636e\n        contentType: false,        // \u544a\u8bc9jQuery\u4e0d\u8981\u53bb\u8bbe\u7f6eContent-Type\u8bf7\u6c42\u5934\n        success: function (res) {\n            var data = JSON.parse(res);\n            if (data.status) {\n                hideLoading();\n                showTips(data.msg);\n                setTimeout(function () {\n                    location.href = 'url?t=' + (new Date()).getTime();\n                }, 200);\n            } else {\n                console.log(data);\n            }\n        },\n        xhr: function () {            //\u5728jquery\u51fd\u6570\u4e2d\u76f4\u63a5\u4f7f\u7528ajax\u7684XMLHttpRequest\u5bf9\u8c61\n            var xhr = new XMLHttpRequest();\n            xhr.upload.addEventListener(\"progress\", function (evt) {\n                if (evt.lengthComputable) {\n                    var percentComplete = Math.round(evt.loaded * 100 / evt.total);\n                    console.log(\"\u6b63\u5728\u63d0\u4ea4...\" + percentComplete.toString() + '%');        //\u5728\u63a7\u5236\u53f0\u6253\u5370\u4e0a\u4f20\u8fdb\u5ea6\n                }\n            }, false);\n            return xhr;\n        }\n    });\n}); \n")),(0,r.kt)("p",null,"\u529f\u80fd\u51fd\u6570: getRectCanvas\uff1a\u7528\u4e8e\u7ed8\u5236\u77e9\u5f62Canvas\uff0c",(0,r.kt)("br",{parentName:"p"}),"\n","convertBase64UrlToBlob\uff1a\u5c06\u4ee5base64\u7684\u56fe\u7247url\u6570\u636e\u8f6c\u6362\u4e3aBlob"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"//\u7ed8\u5236\u77e9\u5f62canvas\nfunction getRectCanvas(sourceCanvas) {\n    var canvas = document.createElement('canvas');\n    var context = canvas.getContext('2d');\n    var width = sourceCanvas.width;\n    var height = sourceCanvas.height;\n    canvas.width = width;\n    canvas.height = height;\n    context.imageSmoothingEnabled = true;\n    context.drawImage(sourceCanvas, 0, 0, width, height);\n    context.globalCompositeOperation = 'destination-in';\n    context.beginPath();\n    context.rect(0, 0, width, height);\n    context.fill();\n    return canvas;\n}\n/**\n* \u5c06\u4ee5base64\u7684\u56fe\u7247url\u6570\u636e\u8f6c\u6362\u4e3aBlob\n* @param urlData\n* \u7528url\u65b9\u5f0f\u8868\u793a\u7684base64\u56fe\u7247\u6570\u636e\n*/\nfunction convertBase64UrlToBlob(urlData) {\n    var bytes = window.atob(urlData.split(',')[1]);       //\u53bb\u6389url\u7684\u5934\uff0c\u5e76\u8f6c\u6362\u4e3abyte\n    //\u5904\u7406\u5f02\u5e38,\u5c06ascii\u7801\u5c0f\u4e8e0\u7684\u8f6c\u6362\u4e3a\u5927\u4e8e0\n    var ab = new ArrayBuffer(bytes.length);\n    var ia = new Uint8Array(ab);\n    for (var i = 0; i < bytes.length; i++) {\n        ia[i] = bytes.charCodeAt(i);\n    }\n    return new Blob([ab], { type: 'image/png' });\n} \n")),(0,r.kt)("h2",{id:"\u540e\u7aefphp\u63a5\u6536\u88c1\u526a\u56fe\u7247\u6570\u636e"},"\u540e\u7aefphp\u63a5\u6536\u88c1\u526a\u56fe\u7247\u6570\u636e"),(0,r.kt)("p",null,"\u63a5\u6536\u6570\u636e\u5206\u4e24\u79cd\u60c5\u51b5\uff1a"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u63a5\u6536Blob\u6587\u4ef6\u6570\u636e")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"$filename = $_FILES['filename'];\nmove_uploaded_file($filename['tmp_name'],'./'.$filename['name'].'png');\nexit(json_encode(['status'=>1,'msg'=>'\u5934\u50cf\u4e0a\u4f20\u6210\u529f'])); \n")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u63a5\u6536base64\u6587\u4ef6\u6570\u636e")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"header('Content-type:text/html;charset=utf-8');\n$base64_image_content = $_FILES['filename'];\n//\u4fdd\u5b58base64\u5b57\u7b26\u4e32\u4e3a\u56fe\u7247\n//\u5339\u914d\u51fa\u56fe\u7247\u7684\u683c\u5f0f\nif (preg_match('/^(data:s*image/(w+);base64,)/', $base64_image_content, $result)) {\n    $type = $result[2];\n    $new_file = \"./test.{$type}\";\n    if (file_put_contents($new_file, base64_decode(str_replace($result[1], '', $base64_image_content)))) {\n        echo '\u65b0\u6587\u4ef6\u4fdd\u5b58\u6210\u529f\uff1a',\n        $new_file;\n    }\n} \n")),(0,r.kt)("p",null,"\u597d\u4e86\u5927\u544a\u6210\u529f\uff0c\u4ee5\u4e0a\u5c31\u662fh5\u5229\u7528cropper.js\u5b9e\u73b0\u56fe\u7247\u88c1\u526a\u5b9e\u73b0\u8fc7\u7a0b"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"demo\u548c\u6e90\u7801")),(0,r.kt)("p",null,"demo:\xa0",(0,r.kt)("a",{parentName:"p",href:"https://lzwdot.github.io/html/cropperjs-demo/index.html"},"https://lzwdot.github.io/html/cropperjs-demo/index.html"),(0,r.kt)("br",{parentName:"p"}),"\n","\u6e90\u7801\uff1a",(0,r.kt)("a",{parentName:"p",href:"https://github.com/lzwdot/html/tree/master/swiper-demo"},"https://github.com/lzwdot/html/tree/master/swiper-demo")))}u.isMDXComponent=!0}}]);