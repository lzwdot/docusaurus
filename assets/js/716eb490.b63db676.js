"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[49610],{3905:(e,n,t)=>{t.d(n,{Zo:()=>u,kt:()=>m});var r=t(67294);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,r,o=function(e,n){if(null==e)return{};var t,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var l=r.createContext({}),c=function(e){var n=r.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):s(s({},n),e)),t},u=function(e){var n=c(e.components);return r.createElement(l.Provider,{value:n},e.children)},p={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},d=r.forwardRef((function(e,n){var t=e.components,o=e.mdxType,a=e.originalType,l=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),d=c(t),m=o,h=d["".concat(l,".").concat(m)]||d[m]||p[m]||a;return t?r.createElement(h,s(s({ref:n},u),{},{components:t})):r.createElement(h,s({ref:n},u))}));function m(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var a=t.length,s=new Array(a);s[0]=d;var i={};for(var l in n)hasOwnProperty.call(n,l)&&(i[l]=n[l]);i.originalType=e,i.mdxType="string"==typeof e?e:o,s[1]=i;for(var c=2;c<a;c++)s[c]=t[c];return r.createElement.apply(null,s)}return r.createElement.apply(null,t)}d.displayName="MDXCreateElement"},87868:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>p,frontMatter:()=>a,metadata:()=>i,toc:()=>c});var r=t(87462),o=(t(67294),t(3905));const a={title:"\u624b\u5199\u7b80\u6613\u7248 Vue 2.0.1",ID:"28654",date:"2021-12-16 22:16:46",categories:["frame","vue-study"],tags:["frame","vue-study"],authors:["lzw"],slug:"/28654",type:"docs"},s=void 0,i={unversionedId:"vue-study/28654",id:"vue-study/28654",title:"\u624b\u5199\u7b80\u6613\u7248 Vue 2.0.1",description:"\u7b80\u6613\u7248 Vue 2.0.1\uff0c\u5b9e\u73b0\u7b80\u5355\u529f\u80fd",source:"@site/docs/vue-study/28654.md",sourceDirName:"vue-study",slug:"/28654",permalink:"/docusaurus/docs/28654",draft:!1,editUrl:"https://github.com/lzwdot/docusaurus/docs/vue-study/28654.md",tags:[{label:"frame",permalink:"/docusaurus/docs/tags/frame"},{label:"vue-study",permalink:"/docusaurus/docs/tags/vue-study"}],version:"current",frontMatter:{title:"\u624b\u5199\u7b80\u6613\u7248 Vue 2.0.1",ID:"28654",date:"2021-12-16 22:16:46",categories:["frame","vue-study"],tags:["frame","vue-study"],authors:["lzw"],slug:"/28654",type:"docs"},sidebar:"tutorialSidebar",previous:{title:"\u624b\u5199\u7b80\u6613\u7248 Vuex",permalink:"/docusaurus/docs/27990"},next:{title:"\u624b\u5199\u7b80\u6613\u7248 Vue 2.0.2",permalink:"/docusaurus/docs/28778"}},l={},c=[{value:"\u7b80\u6613\u7248 Vue 2.0.1\uff0c\u5b9e\u73b0\u7b80\u5355\u529f\u80fd",id:"\u7b80\u6613\u7248-vue-201\u5b9e\u73b0\u7b80\u5355\u529f\u80fd",level:3}],u={toc:c};function p(e){let{components:n,...a}=e;return(0,o.kt)("wrapper",(0,r.Z)({},u,a,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h3",{id:"\u7b80\u6613\u7248-vue-201\u5b9e\u73b0\u7b80\u5355\u529f\u80fd"},"\u7b80\u6613\u7248 Vue 2.0.1\uff0c\u5b9e\u73b0\u7b80\u5355\u529f\u80fd"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\u54cd\u5e94\u5f0f\u5904\u7406"),(0,o.kt)("li",{parentName:"ul"},"\u7f16\u8f91\u6a21\u677f"),(0,o.kt)("li",{parentName:"ul"},"\u7b80\u5355\u6307\u4ee4"),(0,o.kt)("li",{parentName:"ul"},"\u4f9d\u8d56\u6536\u96c6")),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"vue",src:t(28536).Z,width:"1104",height:"609"})),(0,o.kt)("p",null,"\u6d4b\u8bd5\u4ee3\u7801"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-html"},'<!DOCTYPE html>\n<html lang="en">\n<head>\n  <meta charset="UTF-8">\n  <title>Title</title>\n</head>\n<body>\n<div id="app">\n  <p>{{counter}}</p>\n  <p>{{counter}}</p>\n  <p k-text="counter"></p>\n  <p k-html="desc"></p>\n</div>\n<script src="./kvue.js"><\/script>\n<script>\n  const app = new Kvue({\n    el: \'#app\',\n    data: {\n      counter: 1,\n      desc: \'<span style="color: red">lzw. \u771f\u68d2</span>\'\n    }\n  })\n  setInterval(() => {\n    app.counter++\n  }, 1000)\n<\/script>\n</body>\n</html>\n')),(0,o.kt)("p",null,"\u7b80\u6613\u7248 Vue 2.0"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"/**\n * 1\u3001\u5bf9 data \u9009\u9879\u8fdb\u884c\u54cd\u5e94\u5f0f\u5904\u7406\n * 2\u3001\u7f16\u8f91\u6a21\u677f\n * 3\u3001\u6307\u4ee4\u548c\u4e8b\u4ef6\n * 4\u3001\u4f9d\u8d56\u6536\u96c6\n */\nclass Kvue {\n  constructor(options) {\n    this.$options = options\n    this.$data = options.data\n    // \u54cd\u5e94\u5f0f\n    observe(this.$data)\n\n    // \u4ee3\u7406\u4e0b\n    proxy(this)\n\n    // compile \u7f16\u8f91\u6a21\u677f\n    new Compile(options.el, this)\n  }\n\n}\n\n\n// \u6570\u636e\u54cd\u5e94\u5f0f\nfunction defineReactive(obj, key, val) {\n  // \u9012\u5f52\u4e0b\uff0c\u517c\u5bb9 obj[key] = {a:10}\n  observe(obj[key])\n\n  // \u521b\u5efa Key\u3001Dep\u3001Watcher \u7684\u4f9d\u8d56\n  const dep = new Dep()\n\n  Object.defineProperty(obj, key, {\n    get() {\n      console.log('get', key)\n      // \u4f9d\u8d56\u6536\u96c6\n      Dep.target && dep.addDep(Dep.target)\n      return val\n    },\n    set(newVal) {\n      if (newVal !== val) {\n        console.log('set', key)\n        // \u5982\u679c newVal \u662f\u5bf9\u8c61\uff0c\u505a\u54cd\u5e94\u5f0f\u5904\u7406\uff0c\u6bd4\u5982 obj.key = {a:10}\n        observe(newVal)\n        val = newVal\n\n        // watcher \u66f4\u65b0\n        // watchers.forEach(w => w.update())\n        dep.notify()\n      }\n    }\n  })\n}\n\n// \u904d\u5386 obj, \u5bf9\u6240\u6709\u5c5e\u6027\u505a\u54cd\u5e94\u5f0f\nfunction observe(obj) {\n  if (typeof obj !== 'object' || obj == null) {\n    return\n  }\n\n  new Observer(obj)\n}\n\n\n// \u4ee3\u7406\uff0c\u5b9e\u73b0\u7684\u76ee\u7684 vm.$data.counter \u53ef\u4ee5\u901a\u8fc7 vm.counter \u62ff\u5230\nfunction proxy(vm) {\n  Object.keys(vm.$data).forEach(key => {\n    Object.defineProperty(vm, key, {\n      get() {\n        return vm.$data[key]\n      },\n      set(v) {\n        vm.$data[key] = v\n      }\n    })\n  })\n}\n\n\n// \u6839\u636e\u4e0d\u540c\u7c7b\u578b\u505a\u54cd\u5e94\u5f0f\u5904\u7406\nclass Observer {\n  constructor(value) {\n    this.value = value\n\n    if (Array.isArray(value)) {\n      // todo\n    } else {\n      this.walk(value)\n    }\n  }\n\n  walk(obj) {\n    Object.keys(obj).forEach(key => {\n      defineReactive(obj, key, obj[key])\n    })\n  }\n}\n\n// \u89e3\u6790\u6a21\u677f\uff0c1\u3001\u5904\u7406\u63d2\u503c\uff0c2\u3001\u5904\u7406\u6307\u4ee4\u548c\u4e8b\u4ef6\uff0c3\u3001\u4ee5\u4e0a\u4e24\u8005\u7684\u521d\u59cb\u5316\u548c\u66f4\u65b0\n\nclass Compile {\n  constructor(el, vm) {\n    this.$vm = vm\n    this.$el = document.querySelector(el)\n\n    if (this.$el) {\n      this.compile(this.$el)\n    }\n  }\n\n  compile(el) {\n    // \u904d\u5386 el \u5b50\u8282\u70b9\uff0c\u5224\u65ad\u7c7b\u578b\u505a\u76f8\u5e94\u7684\u5904\u7406\n    const childNodes = el.childNodes\n\n    childNodes.forEach(node => {\n      if (node.nodeType === 1) {\n        // \u5143\u7d20\n        // console.log('\u5143\u7d20', node.nodeName)\n        // \u5904\u7406 \u6307\u4ee4\u548c\u4e8b\u4ef6\n        const attrs = node.attributes\n        Array.from(attrs).forEach(attr => {\n          // k-xxx=\"abc\"\n          const attrName = attr.name\n          const exp = attr.value\n          if (attrName.startsWith('k-')) {\n            const dir = attrName.substring(2)\n            this[dir] && this[dir](node, exp)\n          }\n        })\n      } else if (this.isInter(node)) {\n        // \u6587\u672c \u63d2\u503c\u8868\u8fbe\u5f0f\n        // console.log('\u63d2\u503c', node.textContent)\n        this.compileText(node)\n      }\n\n      // \u9012\u5f52\u4e0b\n      if (node.childNodes) {\n        this.compile(node)\n      }\n    })\n  }\n\n  // \u9ad8\u7ea7\u51fd\u6570\u6267\u884c dir\n  update(node, exp, dir) {\n    // 1\u3001\u521d\u59cb\u5316\n    const fn = this[dir + 'Updater']\n    fn && fn(node, this.$vm[exp])\n\n    // 2\u3001\u66f4\u65b0\u64cd\u4f5c\n    new Watcher(this.$vm, exp, function (val) {\n      fn && fn(node, val)\n    })\n  }\n\n  // \u5bf9\u5e94\u7684 k-text \u7684\u6307\u4ee4\n  text(node, exp) {\n    // node.textContent = this.$vm[exp]\n    this.update(node, exp, 'text')\n  }\n\n  textUpdater(node, value) {\n    node.textContent = value\n  }\n\n  // \u7f16\u8bd1 {{xxx}}\u6587\u672c\n  compileText(node) {\n    // node.textContent = this.$vm[RegExp.$1]\n    this.update(node, RegExp.$1, 'text')\n  }\n\n  // \u5bf9\u5e94\u7684 k-html \u7684\u6307\u4ee4\n  html(node, exp) {\n    // node.innerHTML = this.$vm[exp]\n    this.update(node, exp, 'html')\n  }\n\n  htmlUpdater(node, value) {\n    node.innerHTML = value\n  }\n\n  // \u662f\u5426\u63d2\u503c\u8868\u8fbe\u5f0f\n  isInter(node) {\n    return node.nodeType === 3 && /\\{\\{(.*)\\}\\}/.test(node.textContent)\n  }\n}\n\n// \u76d1\u7763\u5668\uff1a\u8d1f\u8d23\u4f9d\u8d56\u66f4\u65b0\uff0c\u6709\u591a\u5c11\u4e2a\u53d8\u91cf\u5c31\u6709\u591a\u5c11\u4e2a watcher\n// const watchers = []\n\nclass Watcher {\n  constructor(vm, key, updateFn) {\n    this.vm = vm\n    this.key = key\n    this.updateFn = updateFn\n\n    // watchers.push(this)\n    Dep.target = this\n    // \u76f8\u5f53\u4e8e\u8c03\u7528\u4e86\u4e00\u6b21 key \u7684 get \u65b9\u6cd5\u8fdb\u884c\u4f9d\u8d56\u6536\u9f50\n    this.vm[this.key]\n    Dep.target = null\n  }\n\n  // \u88ab Dep \u8c03\u7528\u7684\n  update() {\n    // \u6267\u884c\u5b9e\u9645\u7684\u66f4\u65b0\u64cd\u4f5c\n    this.updateFn.call(this.vm, this.vm[this.key])\n  }\n}\n\n// \u5b9e\u73b0 Dep\uff0c\u6709\u591a\u5c11\u4e2a key \u5c31\u6709\u591a\u5c11\u4e2a dep\nclass Dep {\n  constructor() {\n    this.deps = []\n  }\n\n  addDep(dep) {\n    // \u8fd9\u91cc\u7684 dep \u5176\u5b9e\u5c31\u662f watcher\n    this.deps.push(dep)\n  }\n\n  notify() {\n    // \u8fd9\u91cc\u7684 dep \u5176\u5b9e\u5c31\u662f watcher\n    this.deps.forEach(dep => dep.update())\n  }\n}\n")))}p.isMDXComponent=!0},28536:(e,n,t)=>{t.d(n,{Z:()=>r});const r=t.p+"assets/images/20211214221640-691431296722fc7cc3bd923d35770d70.png"}}]);