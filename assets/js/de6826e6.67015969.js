"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[36127],{3905:(e,t,l)=>{l.d(t,{Zo:()=>o,kt:()=>m});var a=l(67294);function n(e,t,l){return t in e?Object.defineProperty(e,t,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[t]=l,e}function p(e,t){var l=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),l.push.apply(l,a)}return l}function s(e){for(var t=1;t<arguments.length;t++){var l=null!=arguments[t]?arguments[t]:{};t%2?p(Object(l),!0).forEach((function(t){n(e,t,l[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(l)):p(Object(l)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(l,t))}))}return e}function r(e,t){if(null==e)return{};var l,a,n=function(e,t){if(null==e)return{};var l,a,n={},p=Object.keys(e);for(a=0;a<p.length;a++)l=p[a],t.indexOf(l)>=0||(n[l]=e[l]);return n}(e,t);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(a=0;a<p.length;a++)l=p[a],t.indexOf(l)>=0||Object.prototype.propertyIsEnumerable.call(e,l)&&(n[l]=e[l])}return n}var i=a.createContext({}),u=function(e){var t=a.useContext(i),l=t;return e&&(l="function"==typeof e?e(t):s(s({},t),e)),l},o=function(e){var t=u(e.components);return a.createElement(i.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var l=e.components,n=e.mdxType,p=e.originalType,i=e.parentName,o=r(e,["components","mdxType","originalType","parentName"]),c=u(l),m=n,d=c["".concat(i,".").concat(m)]||c[m]||b[m]||p;return l?a.createElement(d,s(s({ref:t},o),{},{components:l})):a.createElement(d,s({ref:t},o))}));function m(e,t){var l=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var p=l.length,s=new Array(p);s[0]=c;var r={};for(var i in t)hasOwnProperty.call(t,i)&&(r[i]=t[i]);r.originalType=e,r.mdxType="string"==typeof e?e:n,s[1]=r;for(var u=2;u<p;u++)s[u]=l[u];return a.createElement.apply(null,s)}return a.createElement.apply(null,l)}c.displayName="MDXCreateElement"},86426:(e,t,l)=>{l.r(t),l.d(t,{assets:()=>i,contentTitle:()=>s,default:()=>b,frontMatter:()=>p,metadata:()=>r,toc:()=>u});var a=l(87462),n=(l(67294),l(3905));const p={title:"Linux\u4e0aiptables\u9632\u706b\u5899\u7684\u57fa\u672c\u5e94\u7528\u6559\u7a0b",ID:"15878",date:"2018-04-21 11:11:13",categories:["server","linux"],tags:["server","linux"],authors:["lzw"],slug:"/15878",type:"blog"},s=void 0,r={permalink:"/docusaurus/blog/15878",editUrl:"https://github.com/lzwdot/docusaurus/blog/2018/04-21-15878.md",source:"@site/blog/2018/04-21-15878.md",title:"Linux\u4e0aiptables\u9632\u706b\u5899\u7684\u57fa\u672c\u5e94\u7528\u6559\u7a0b",description:"iptables\u662fLinux\u4e0a\u5e38\u7528\u7684\u9632\u706b\u5899\u8f6f\u4ef6\uff0c\u4e0b\u9762\u8bf4\u4e00\u4e0biptables\u7684\u5b89\u88c5\u3001\u6e05\u9664iptables\u89c4\u5219\u3001iptables\u53ea\u5f00\u653e\u6307\u5b9a\u7aef\u53e3\u3001iptables\u5c4f\u853d\u6307\u5b9aip\u3001ip\u6bb5\u53ca\u89e3\u5c01\u3001\u5220\u9664\u5df2\u6dfb\u52a0\u7684iptables\u89c4\u5219\u7b49iptables\u7684\u57fa\u672c\u5e94\u7528\u3002",date:"2018-04-21T11:11:13.000Z",formattedDate:"2018\u5e744\u670821\u65e5",tags:[{label:"server",permalink:"/docusaurus/blog/tags/server"},{label:"linux",permalink:"/docusaurus/blog/tags/linux"}],readingTime:4.87,hasTruncateMarker:!0,authors:[{name:"lzw.",title:"\u4e00\u4e2a web \u5f00\u53d1\u8005",url:"https://github.com/lzwdot",imageURL:"https://avatars.githubusercontent.com/u/24477920?v=4",key:"lzw"}],frontMatter:{title:"Linux\u4e0aiptables\u9632\u706b\u5899\u7684\u57fa\u672c\u5e94\u7528\u6559\u7a0b",ID:"15878",date:"2018-04-21 11:11:13",categories:["server","linux"],tags:["server","linux"],authors:["lzw"],slug:"/15878",type:"blog"},prevItem:{title:"MySQL\u5b57\u7b26\u96c6\u4fee\u6539\u4e3autf8mb4",permalink:"/docusaurus/blog/15882"},nextItem:{title:"\u539f\u751fjs\u64cd\u4f5ccookie\uff0c\u6709\u6548\u671f\u81f3\u665a\u4e0a23\u70b959\u520659\u79d2",permalink:"/docusaurus/blog/15825"}},i={authorsImageUrls:[void 0]},u=[{value:"1\u3001\u5b89\u88c5iptables\u9632\u706b\u5899",id:"1\u5b89\u88c5iptables\u9632\u706b\u5899",level:4},{value:"2\u3001\u6e05\u9664\u5df2\u6709iptables\u89c4\u5219",id:"2\u6e05\u9664\u5df2\u6709iptables\u89c4\u5219",level:4},{value:"3\u3001\u5f00\u653e\u6307\u5b9a\u7684\u7aef\u53e3",id:"3\u5f00\u653e\u6307\u5b9a\u7684\u7aef\u53e3",level:4},{value:"4\u3001\u5c4f\u853dIP",id:"4\u5c4f\u853dip",level:4},{value:"5\u3001\u5c4f\u853d\u6216\u5141\u8bb8\u67d0IP\u8bbf\u95ee\u6307\u5b9a\u7aef\u53e3",id:"5\u5c4f\u853d\u6216\u5141\u8bb8\u67d0ip\u8bbf\u95ee\u6307\u5b9a\u7aef\u53e3",level:4},{value:"6\u3001\u67e5\u770b\u5df2\u6dfb\u52a0\u7684iptables\u89c4\u5219",id:"6\u67e5\u770b\u5df2\u6dfb\u52a0\u7684iptables\u89c4\u5219",level:4},{value:"7\u3001\u5220\u9664\u5df2\u6dfb\u52a0\u7684iptables\u89c4\u5219",id:"7\u5220\u9664\u5df2\u6dfb\u52a0\u7684iptables\u89c4\u5219",level:4},{value:"8\u3001iptables\u7684\u5f00\u673a\u542f\u52a8\u53ca\u89c4\u5219\u4fdd\u5b58",id:"8iptables\u7684\u5f00\u673a\u542f\u52a8\u53ca\u89c4\u5219\u4fdd\u5b58",level:4},{value:"9\u3001\u67e5\u770biptables\u542f\u52a8\u72b6\u6001",id:"9\u67e5\u770biptables\u542f\u52a8\u72b6\u6001",level:4}],o={toc:u};function b(e){let{components:t,...l}=e;return(0,n.kt)("wrapper",(0,a.Z)({},o,l,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("p",null,"iptables\u662fLinux\u4e0a\u5e38\u7528\u7684\u9632\u706b\u5899\u8f6f\u4ef6\uff0c\u4e0b\u9762\u8bf4\u4e00\u4e0biptables\u7684\u5b89\u88c5\u3001\u6e05\u9664iptables\u89c4\u5219\u3001iptables\u53ea\u5f00\u653e\u6307\u5b9a\u7aef\u53e3\u3001iptables\u5c4f\u853d\u6307\u5b9aip\u3001ip\u6bb5\u53ca\u89e3\u5c01\u3001\u5220\u9664\u5df2\u6dfb\u52a0\u7684iptables\u89c4\u5219\u7b49iptables\u7684\u57fa\u672c\u5e94\u7528\u3002"),(0,n.kt)("h4",{id:"1\u5b89\u88c5iptables\u9632\u706b\u5899"},"1\u3001\u5b89\u88c5iptables\u9632\u706b\u5899"),(0,n.kt)("p",null,"\u5982\u679c\u6ca1\u6709\u5b89\u88c5iptables\u9700\u8981\u5148\u5b89\u88c5\uff0cCentOS\u6267\u884c\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},"yum install iptables\n")),(0,n.kt)("p",null,"Debian/Ubuntu\u6267\u884c\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},"apt-get install iptables\n")),(0,n.kt)("h4",{id:"2\u6e05\u9664\u5df2\u6709iptables\u89c4\u5219"},"2\u3001\u6e05\u9664\u5df2\u6709iptables\u89c4\u5219"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},"iptables -F\niptables -X\niptables -Z\n")),(0,n.kt)("h4",{id:"3\u5f00\u653e\u6307\u5b9a\u7684\u7aef\u53e3"},"3\u3001\u5f00\u653e\u6307\u5b9a\u7684\u7aef\u53e3"),(0,n.kt)("p",null,"-","A\u548c-I\u53c2\u6570\u5206\u522b\u4e3a\u6dfb\u52a0\u5230\u89c4\u5219\u672b\u5c3e\u548c\u89c4\u5219\u6700\u524d\u9762\u3002"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},"#\u5141\u8bb8\u672c\u5730\u56de\u73af\u63a5\u53e3(\u5373\u8fd0\u884c\u672c\u673a\u8bbf\u95ee\u672c\u673a)\niptables -A INPUT -i lo -j ACCEPT\n# \u5141\u8bb8\u5df2\u5efa\u7acb\u7684\u6216\u76f8\u5173\u8fde\u7684\u901a\u884c\niptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT\n#\u5141\u8bb8\u6240\u6709\u672c\u673a\u5411\u5916\u7684\u8bbf\u95ee\niptables -A OUTPUT -j ACCEPT\n# \u5141\u8bb8\u8bbf\u95ee22\u7aef\u53e3\niptables -A INPUT -p tcp --dport 22 -j ACCEPT\n#\u5141\u8bb8\u8bbf\u95ee80\u7aef\u53e3\niptables -A INPUT -p tcp --dport 80 -j ACCEPT\n#\u5141\u8bb8\u8bbf\u95ee443\u7aef\u53e3\niptables -A INPUT -p tcp --dport 443 -j ACCEPT\n#\u5141\u8bb8FTP\u670d\u52a1\u768421\u548c20\u7aef\u53e3\niptables -A INPUT -p tcp --dport 21 -j ACCEPT\niptables -A INPUT -p tcp --dport 20 -j ACCEPT\n#\u5982\u679c\u6709\u5176\u4ed6\u7aef\u53e3\u7684\u8bdd\uff0c\u89c4\u5219\u4e5f\u7c7b\u4f3c\uff0c\u7a0d\u5fae\u4fee\u6539\u4e0a\u8ff0\u8bed\u53e5\u5c31\u884c\n#\u5141\u8bb8ping\niptables -A INPUT -p icmp -m icmp --icmp-type 8 -j ACCEPT\n#\u7981\u6b62\u5176\u4ed6\u672a\u5141\u8bb8\u7684\u89c4\u5219\u8bbf\u95ee\niptables -A INPUT -j REJECT  #\uff08\u6ce8\u610f\uff1a\u5982\u679c22\u7aef\u53e3\u672a\u52a0\u5165\u5141\u8bb8\u89c4\u5219\uff0cSSH\u94fe\u63a5\u4f1a\u76f4\u63a5\u65ad\u5f00\u3002\uff09\niptables -A FORWARD -j REJECT\n")),(0,n.kt)("h4",{id:"4\u5c4f\u853dip"},"4\u3001\u5c4f\u853dIP"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},"#\u5982\u679c\u53ea\u662f\u60f3\u5c4f\u853dIP\u7684\u8bdd\u201c3\u3001\u5f00\u653e\u6307\u5b9a\u7684\u7aef\u53e3\u201d\u53ef\u4ee5\u76f4\u63a5\u8df3\u8fc7\u3002\n#\u5c4f\u853d\u5355\u4e2aIP\u7684\u547d\u4ee4\u662f\niptables -I INPUT -s 123.45.6.7 -j DROP\n#\u5c01\u6574\u4e2a\u6bb5\u5373\u4ece123.0.0.1\u5230123.255.255.254\u7684\u547d\u4ee4\niptables -I INPUT -s 123.0.0.0/8 -j DROP\n#\u5c01IP\u6bb5\u5373\u4ece123.45.0.1\u5230123.45.255.254\u7684\u547d\u4ee4\niptables -I INPUT -s 124.45.0.0/16 -j DROP\n#\u5c01IP\u6bb5\u5373\u4ece123.45.6.1\u5230123.45.6.254\u7684\u547d\u4ee4\u662f\niptables -I INPUT -s 123.45.6.0/24 -j DROP\n")),(0,n.kt)("h4",{id:"5\u5c4f\u853d\u6216\u5141\u8bb8\u67d0ip\u8bbf\u95ee\u6307\u5b9a\u7aef\u53e3"},"5\u3001\u5c4f\u853d\u6216\u5141\u8bb8\u67d0IP\u8bbf\u95ee\u6307\u5b9a\u7aef\u53e3"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},"#\u5c4f\u853d\u67d0IP\u8bbf\u95ee\u6307\u5b9a\u7aef\u53e3\uff0c\u4ee522\u7aef\u53e3\u4e3a\u4f8b\u547d\u4ee4\u662f\niptables -I INPUT -s 123.45.6.7 -p tcp --dport 22 -j DROP\n#\u5141\u8bb8\u67d0IP\u8bbf\u95ee\u6307\u5b9a\u7aef\u53e3\uff0c\u4ee522\u7aef\u53e3\u4e3a\u4f8b\u547d\u4ee4\u662f\niptables -I INPUT -p tcp --dport 22 -j DROP\niptables -I INPUT -s 123.45.6.7 -p tcp --dport 22 -j ACCEPT\n")),(0,n.kt)("h4",{id:"6\u67e5\u770b\u5df2\u6dfb\u52a0\u7684iptables\u89c4\u5219"},"6\u3001\u67e5\u770b\u5df2\u6dfb\u52a0\u7684iptables\u89c4\u5219"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},"iptables -L -n\n")),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"v\uff1a\u663e\u793a\u8be6\u7ec6\u4fe1\u606f\uff0c\u5305\u62ec\u6bcf\u6761\u89c4\u5219\u7684\u5339\u914d\u5305\u6570\u91cf\u548c\u5339\u914d\u5b57\u8282\u6570",(0,n.kt)("br",{parentName:"p"}),"\n","x\uff1a\u5728 v \u7684\u57fa\u7840\u4e0a\uff0c\u7981\u6b62\u81ea\u52a8\u5355\u4f4d\u6362\u7b97\uff08K\u3001M\uff09 vps\u4fa6\u63a2",(0,n.kt)("br",{parentName:"p"}),"\n","n\uff1a\u53ea\u663e\u793aIP\u5730\u5740\u548c\u7aef\u53e3\u53f7\uff0c\u4e0d\u5c06ip\u89e3\u6790\u4e3a\u57df\u540d")),(0,n.kt)("h4",{id:"7\u5220\u9664\u5df2\u6dfb\u52a0\u7684iptables\u89c4\u5219"},"7\u3001\u5220\u9664\u5df2\u6dfb\u52a0\u7684iptables\u89c4\u5219"),(0,n.kt)("p",null,"\u5c06\u6240\u6709iptables\u4ee5\u5e8f\u53f7\u6807\u8bb0\u663e\u793a\uff0c\u6267\u884c\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},"iptables -L -n --line-numbers\n")),(0,n.kt)("p",null,"\u6bd4\u5982\u8981\u5220\u9664INPUT\u91cc\u5e8f\u53f7\u4e3a8\u7684\u89c4\u5219(\u8981\u5220\u9664OUTPUT\u7684\u8bdd\u5c31\u6539\u6210OUTPUT\uff0c\u4ee5\u6b64\u7c7b\u63a8)\uff0c\u6267\u884c\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},"iptables -D INPUT 8\n")),(0,n.kt)("h4",{id:"8iptables\u7684\u5f00\u673a\u542f\u52a8\u53ca\u89c4\u5219\u4fdd\u5b58"},"8\u3001iptables\u7684\u5f00\u673a\u542f\u52a8\u53ca\u89c4\u5219\u4fdd\u5b58"),(0,n.kt)("p",null,"CentOS\u4e0a\u53ef\u80fd\u4f1a\u5b58\u5728\u5b89\u88c5\u597diptables\u540e\uff0ciptables\u5e76\u4e0d\u5f00\u673a\u81ea\u542f\u52a8\uff0c\u53ef\u4ee5\u6267\u884c\u4e00\u4e0b\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},"chkconfig --level 345 iptables on\n")),(0,n.kt)("p",null,"\u5c06\u5176\u52a0\u5165\u5f00\u673a\u542f\u52a8\u3002"),(0,n.kt)("p",null,"CentOS\u4e0a\u53ef\u4ee5\u6267\u884c\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},"service iptables save\n")),(0,n.kt)("p",null,"\u4fdd\u5b58\u89c4\u5219\u3002"),(0,n.kt)("p",null,"\u53e6\u5916\u66f4\u9700\u8981\u6ce8\u610f\u7684\u662fDebian/Ubuntu\u4e0aiptables\u662f\u4e0d\u4f1a\u4fdd\u5b58\u89c4\u5219\u7684\u3002"),(0,n.kt)("p",null,"\u9700\u8981\u6309\u5982\u4e0b\u6b65\u9aa4\u8fdb\u884c\uff0c\u8ba9\u7f51\u5361\u5173\u95ed\u662f\u4fdd\u5b58iptables\u89c4\u5219\uff0c\u542f\u52a8\u65f6\u52a0\u8f7diptables\u89c4\u5219\uff1a"),(0,n.kt)("p",null,"\u521b\u5efa/etc/network/if-post-down.d/iptables \u6587\u4ef6\uff0c\u6dfb\u52a0\u5982\u4e0b\u5185\u5bb9\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},"#!/bin/bash\niptables-save > /etc/iptables.rules\n")),(0,n.kt)("p",null,"\u6267\u884c\uff1achmod +x /etc/network/if-post-down.d/iptables \u6dfb\u52a0\u6267\u884c\u6743\u9650\u3002"),(0,n.kt)("p",null,"\u521b\u5efa/etc/network/if-pre-up.d/iptables \u6587\u4ef6\uff0c\u6dfb\u52a0\u5982\u4e0b\u5185\u5bb9\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},"#!/bin/bash\niptables-restore < /etc/iptables.rules\n")),(0,n.kt)("p",null,"\u6267\u884c\uff1achmod +x /etc/network/if-pre-up.d/iptables \u6dfb\u52a0\u6267\u884c\u6743\u9650\u3002"),(0,n.kt)("p",null,"\u5173\u4e8e\u66f4\u591a\u7684iptables\u7684\u4f7f\u7528\u65b9\u6cd5\u53ef\u4ee5\u6267\u884c\uff1aiptables \u2013help\u6216\u7f51\u4e0a\u641c\u7d22\u4e00\u4e0biptables\u53c2\u6570\u7684\u8bf4\u660e\u3002"),(0,n.kt)("h4",{id:"9\u67e5\u770biptables\u542f\u52a8\u72b6\u6001"},"9\u3001\u67e5\u770biptables\u542f\u52a8\u72b6\u6001"),(0,n.kt)("p",null,"iptables \u6240\u5728\u76ee\u5f55 \uff1a/etc/sysconfig/iptables"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},"# service iptables status    #\u67e5\u770biptables\u72b6\u6001\n# service iptables restart   #iptables\u670d\u52a1\u91cd\u542f\n# service iptables stop      #iptables\u670d\u52a1\u7981\u7528\n")),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"\u51fa\u5904\uff1aVPS\u4fa6\u63a2 \u672c\u6587\u94fe\u63a5\u5730\u5740\uff1a",(0,n.kt)("a",{parentName:"p",href:"https://www.vpser.net/security/linux-iptables.html"},"https://www.vpser.net/security/linux-iptables.html"))))}b.isMDXComponent=!0}}]);