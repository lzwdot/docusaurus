"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[11207],{3905:(n,e,t)=>{t.d(e,{Zo:()=>u,kt:()=>y});var a=t(67294);function s(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function r(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,a)}return t}function o(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?r(Object(t),!0).forEach((function(e){s(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}function c(n,e){if(null==n)return{};var t,a,s=function(n,e){if(null==n)return{};var t,a,s={},r=Object.keys(n);for(a=0;a<r.length;a++)t=r[a],e.indexOf(t)>=0||(s[t]=n[t]);return s}(n,e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);for(a=0;a<r.length;a++)t=r[a],e.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(n,t)&&(s[t]=n[t])}return s}var l=a.createContext({}),i=function(n){var e=a.useContext(l),t=e;return n&&(t="function"==typeof n?n(e):o(o({},e),n)),t},u=function(n){var e=i(n.components);return a.createElement(l.Provider,{value:e},n.children)},p={inlineCode:"code",wrapper:function(n){var e=n.children;return a.createElement(a.Fragment,{},e)}},m=a.forwardRef((function(n,e){var t=n.components,s=n.mdxType,r=n.originalType,l=n.parentName,u=c(n,["components","mdxType","originalType","parentName"]),m=i(t),y=s,g=m["".concat(l,".").concat(y)]||m[y]||p[y]||r;return t?a.createElement(g,o(o({ref:e},u),{},{components:t})):a.createElement(g,o({ref:e},u))}));function y(n,e){var t=arguments,s=e&&e.mdxType;if("string"==typeof n||s){var r=t.length,o=new Array(r);o[0]=m;var c={};for(var l in e)hasOwnProperty.call(e,l)&&(c[l]=e[l]);c.originalType=n,c.mdxType="string"==typeof n?n:s,o[1]=c;for(var i=2;i<r;i++)o[i]=t[i];return a.createElement.apply(null,o)}return a.createElement.apply(null,t)}m.displayName="MDXCreateElement"},13243:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>l,contentTitle:()=>o,default:()=>p,frontMatter:()=>r,metadata:()=>c,toc:()=>i});var a=t(87462),s=(t(67294),t(3905));const r={title:"async/await \u662f\u8bed\u6cd5\u7cd6\uff0c\u5f02\u6b65\u7684\u672c\u8d28\u8fd8\u662f\u56de\u8c03\u51fd\u6570 !25817",ID:"25817",date:"2020-10-20 16:59:33",categories:["async","js-asyn"],tags:["async","js-asyn"],authors:["lzw"],slug:"/25817",type:"issues"},o="async/await \u662f\u8bed\u6cd5\u7cd6\uff0c\u5f02\u6b65\u7684\u672c\u8d28\u8fd8\u662f\u56de\u8c03\u51fd\u6570",c={unversionedId:"async/25817",id:"async/25817",title:"async/await \u662f\u8bed\u6cd5\u7cd6\uff0c\u5f02\u6b65\u7684\u672c\u8d28\u8fd8\u662f\u56de\u8c03\u51fd\u6570 !25817",description:"async/await \u8bed\u6cd5",source:"@site/issues/async/25817.md",sourceDirName:"async",slug:"/25817",permalink:"/docusaurus/issues/25817",draft:!1,tags:[{label:"async",permalink:"/docusaurus/issues/tags/async"},{label:"js-asyn",permalink:"/docusaurus/issues/tags/js-asyn"}],version:"current",frontMatter:{title:"async/await \u662f\u8bed\u6cd5\u7cd6\uff0c\u5f02\u6b65\u7684\u672c\u8d28\u8fd8\u662f\u56de\u8c03\u51fd\u6570 !25817",ID:"25817",date:"2020-10-20 16:59:33",categories:["async","js-asyn"],tags:["async","js-asyn"],authors:["lzw"],slug:"/25817",type:"issues"},sidebar:"tutorialSidebar",previous:{title:"promise \u5173\u4e8e then \u548c catch \u7684\u94fe\u63a5\u95ee\u9898 !25815",permalink:"/docusaurus/issues/25815"},next:{title:"promise \u548c setTimeout \u7684\u987a\u5e8f !25819",permalink:"/docusaurus/issues/25819"}},l={},i=[],u={toc:i};function p(n){let{components:e,...t}=n;return(0,s.kt)("wrapper",(0,a.Z)({},u,t,{components:e,mdxType:"MDXLayout"}),(0,s.kt)("h1",{id:"asyncawait-\u662f\u8bed\u6cd5\u7cd6\u5f02\u6b65\u7684\u672c\u8d28\u8fd8\u662f\u56de\u8c03\u51fd\u6570"},"async/await \u662f\u8bed\u6cd5\u7cd6\uff0c\u5f02\u6b65\u7684\u672c\u8d28\u8fd8\u662f\u56de\u8c03\u51fd\u6570"),(0,s.kt)("p",null,"async/await \u8bed\u6cd5"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"\u5f02\u6b65\u56de\u8c03\u5bb9\u6613\u4ea7\u751f callback hell\uff08\u56de\u8c03\u5730\u72f1\uff09"),(0,s.kt)("li",{parentName:"ul"},"Promise then catch \u94fe\u5f0f\u8c03\u7528\uff0c\u4f46\u4e5f\u662f\u57fa\u4e8e\u56de\u8c03\u51fd\u6570"),(0,s.kt)("li",{parentName:"ul"},"async/await \u662f\u540c\u6b65\u8bed\u6cd5\uff0c\u5f7b\u5e95\u6d88\u706d\u56de\u8c03\u51fd\u6570\uff0c\u4ee3\u7801\u6f14\u793a\uff1a")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-js"},"//\u52a0\u8f7d\u56fe\u7247\nfunction loadImg(src) {\n    const p = new Promise((resolve, reject) => {\n        const img = document.createElement('img')\n        img.onload = () => {\n            resolve(img)\n        }\n        img.onerror = () => {\n            const err = new Error(`\u56fe\u7247\u52a0\u8f7d\u5931\u8d25 ${src}`)\n            reject()\n        }\n        img.src = src\n    })\n    return p\n}\nconst src1 = 'https://www.baidu.com/img/PCtm_d9c8750bed0b3c7d089fa7d55720d6cf.png'\nconst src2 = 'https://box.bdimg.com/static/fisp_static/common/img/searchbox/logo_news_276_88_1f9876a.png'\n// !\u7528\u4e8e\u89e3\u51b3\u62a5\u9519 Uncaught TypeError: \"https...\" is not a function is not a function\n!(async function(){\n    // \u540c\u6b65\u7684\u5199\u6cd5\n    const img1 = await loadImg1()//\u4e5f\u53ef\u4ee5\u76f4\u63a5\u7528 loadImg(src1)\n    console.log(img1.width,img1.height)\n    const img2 = await loadImg2() //\u4e5f\u53ef\u4ee5\u76f4\u63a5\u7528 loadImg(src2)\n    console.log(img2.width,img2.height)\n})()\nasync function loadImg1(){\n    const img1 = await loadImg(src1)\n    return img1\n}\nasync function loadImg2(){\n    const img2 = await loadImg(src2)\n    return img2\n}\n")),(0,s.kt)("p",null,"async/await \u548c Promise \u7684\u5173\u7cfb"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"async/await \u662f\u6d88\u706d\u5f02\u6b65\u56de\u8c03\u7684\u7ec8\u6781\u6b66\u5668"),(0,s.kt)("li",{parentName:"ul"},"\u4f46\u548c Promise \u5e76\u4e0d\u4e92\u65a5\uff0c\u53cd\u800c\u4e24\u8005\u76f8\u8f85\u76f8\u6210"),(0,s.kt)("li",{parentName:"ul"},"\u6267\u884c async \u51fd\u6570\uff0c\u8fd4\u56de\u7684\u662f Promise \u5bf9\u8c61")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-js"},"async function fn1(){\n    return 100\n    // return Promise.resolve(200)\n}\nconst res1 = fn1() // \u6267\u884c async \u51fd\u6570\uff0c\u8fd4\u56de Promise \u5bf9\u8c61\nconsole.log('res1',res1) // res1 Promise\nres1.then(data=>{\n    console.log('data1',data) // data1 100\n})\n")),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"await \u76f8\u5f53\u4e8e Promise \u7684 then")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-js"},"async function fn1(){\n    return 100\n    // return Promise.resolve(200)\n}\n!(async function(){\n    const p1 = Promise.resolve(300)\n    const data = await p1 // await \u76f8\u5f53\u4e8e Promise then\n    console.log('data',data) // data 300\n})()\n!(async function(){\n    const data1 = await 400 // \u76f4\u63a5\u8fd4\u56de 400\n    console.log('data',data1) // data 400\n})()\n!(async function(){\n    const data2 = await fn1() // await \u76f8\u5f53\u4e8e Promise.resolve(100)\n    console.log('data',data2) // data 100\n})()\n")),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"try...catch \u53ef\u6355\u83b7\u5f02\u5e38\uff0c\u4ee3\u66ff\u4e86 Promise \u7684 catch")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-js"},"!(async function () {\n    const p4 = Promise.reject('err') // rejected\u72b6\u6001\n    try {\n        const res4 = await p4\n        console.log('res4', res4) // \u4e0d\u6267\u884c\n    } catch (e) {\n        console.error('err4',e) //err4 err try\u2026catch \u76f8\u5f53\u4e8e Promise catch\n    }\n})()\n// \u6ca1\u6709 try\u2026catch \u65e0\u6cd5\u6355\u83b7\u9519\u8bef\n!(async function(){\n    const p5 = Promise.reject('err1') // rejected\u72b6\u6001\n    const res5 = await p5 // await -> then\uff0c\u4e0b\u9762\u4e0d\u4f1a\u6267\u884c\n    console.log('res5',res5) // \u4e0d\u6267\u884c\n})()\n")),(0,s.kt)("p",null,"\u5f02\u6b65\u7684\u672c\u8d28"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"async/await \u662f\u6d88\u706d\u5f02\u6b65\u56de\u8c03\u7684\u7ec8\u6781\u6b66\u5668"),(0,s.kt)("li",{parentName:"ul"},"JS \u8fd8\u662f\u5355\u7ebf\u7a0b\uff0c\u8fd8\u5f97\u662f\u6709\u5f02\u6b65\uff0c\u8fd8\u5f97\u662f\u57fa\u4e8e event loop"),(0,s.kt)("li",{parentName:"ul"},"async/await \u53ea\u662f\u4e00\u4e2a\u8bed\u6cd5\u7cd6\uff0c\u4ee3\u7801\u6f14\u793a\uff1a")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-js"},"async function async1() {\n    console.log('async1 start') // step 2\n    await async2() //undefined\n    // await \u7684\u540e\u9762\uff0c\u90fd\u53ef\u4ee5\u770b\u505a\u662f callback \u91cc\u7684\u5185\u5bb9\uff0c\u5373\u5f02\u6b65\n    // \u7c7b\u4f3c event loop\uff0csetTimeout(function(){ console.log('async1 end')})\n    // \u6216 Promise.resolve().then(()=>{console.log('async1 end')})\n    console.log('async1 end') // step 5\n}\nasync function async2() {\n    console.log('async2') // step 3\n}\nconsole.log('script start') // step 1\nasync1()\nconsole.log('script end') // step 4\n// \u540c\u6b65\u4ee3\u7801\u5df2\u7ecf\u6267\u884c\u5b8c\uff08event loop\uff09\n// script start\n// async1 start\n// async2\n// script end\n// async1 end\n")),(0,s.kt)("p",null,"\u518d\u770b\u4e00\u4e2a\u4f8b\u5b50\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-js"},"async function async1() {\n    console.log('async1 start') // step 2\n    await async2()\n    // \u4e0b\u9762\u90fd\u662f\u5f02\u6b65\u56de\u8c03 callback \u7684\u5185\u5bb9\n    console.log('async1 end') // step 5\n    await async3()\n    // \u4e0b\u9762\u90fd\u662f\u5f02\u6b65\u56de\u8c03 callback \u7684\u5185\u5bb9\n    console.log('async1 end 2') // step 7\n}\nasync function async2() {\n    console.log('async2') // step 3\n}\nasync function async3(){\n    console.log('async3') // step 6\n}\nconsole.log('script start') // step 1\nasync1()\nconsole.log('script end') // step 4\n// \u540c\u6b65\u4ee3\u7801\u5df2\u7ecf\u6267\u884c\u5b8c\uff08event loop\uff09\n// script start\n// async1 start\n// async2\n// script end\n// async1 end\n// async3\n// async1 end 2\n")),(0,s.kt)("p",null,"\u8865\u5145 for ... of \u5f02\u6b65\u7684\u4f7f\u7528"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"for ... in \uff08\u4ee5\u53ca forEach for \uff09\u662f\u5e38\u89c4\u7684\u540c\u6b65\u904d\u5386"),(0,s.kt)("li",{parentName:"ul"},"for ... of \u5e38\u7528\u4e8e\u5f02\u6b65\u7684\u904d\u5386")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-js"},"function muti(num) {\n    return new Promise(resolve => {\n        setTimeout(() => {\n            resolve(num * num)\n        }, 1000)\n    })\n}\nconst nums = [1, 2, 3]\nnums.forEach(async (i) => { // 1\u79d2\u540e\u540c\u6b65\u6267\u884c\n    const res = await muti(i) // \u76f8\u5f53\u4e8e Promise \u7684 then\n    console.log(res) // 1 4 9\n})\n!(async function () {\n    for (let i of nums) { // 1\u79d2\u6267\u884c\u4e00\u4e2a\n        const res = await muti(i) // \u76f8\u5f53\u4e8e Promise \u7684 then\n        console.log(res) // 1 4 9\n    }\n})()\n")))}p.isMDXComponent=!0}}]);